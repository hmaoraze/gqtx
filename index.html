<!doctype html>
<!DOCTYPE html><html lang="zh-CN" style="opacity: 1; font-size: 26.6666px;"><head><meta charset="utf-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="迎国庆换新颜">
    <meta name="keywords" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1,user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta name="format-detection" content="telphone=no,email=no,address=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="icon" href="img/logo.png">
    <title>
      迎国庆换新颜-国庆头像
    </title>
    <script charset="utf-8" async="" src="js/jweixin-1.0.0.js">
    </script>

    <script>
      !
      function() {
        var i = 0; !
        function e(t) {
          var n = 40; (document.documentElement.clientWidth !== window.innerWidth || 0 === document.documentElement.clientWidth && 0 === window.innerWidth) && i < 10 ? (document.documentElement.style.opacity = 0, window.setTimeout(e, 0), i++) : (document.documentElement.style.opacity = 0, setTimeout(function() {
            var e = 500 < window.innerWidth ? 500 : window.innerWidth;
            n = parseInt(e / 750 * 1e4 * 40) / 1e4,
            document.documentElement.style.opacity = 1,
            document.documentElement.style.fontSize = n + "px"
          },
          0))
        } ()
      } ()
    </script>
    <script src="js/TGMobileShare-noadtag19.min.js">
    </script>
    <script>
      !
      function(n) {
        "use strict";
        n.loadCSS || (n.loadCSS = function() {});
        var o = loadCSS.relpreload = {};
        if (o.support = function() {
          var e;
          try {
            e = n.document.createElement("link").relList.supports("preload")
          } catch(t) {
            e = !1
          }
          return function() {
            return e
          }
        } (), o.bindMediaToggle = function(t) {
          function e() {
            t.media = a
          }
          var a = t.media || "all";
          t.addEventListener ? t.addEventListener("load", e) : t.attachEvent && t.attachEvent("onload", e),
          setTimeout(function() {
            t.rel = "stylesheet",
            t.media = "only x"
          }),
          setTimeout(e, 3e3)
        },
        o.poly = function() {
          if (!o.support()) for (var t = n.document.getElementsByTagName("link"), e = 0; e < t.length; e++) {
            var a = t[e];
            "preload" !== a.rel || "style" !== a.getAttribute("as") || a.getAttribute("data-loadcss") || (a.setAttribute("data-loadcss", !0), o.bindMediaToggle(a))
          }
        },
        !o.support()) {
          o.poly();
          var t = n.setInterval(o.poly, 500);
          n.addEventListener ? n.addEventListener("load",
          function() {
            o.poly(),
            n.clearInterval(t)
          }) : n.attachEvent && n.attachEvent("onload",
          function() {
            o.poly(),
            n.clearInterval(t)
          })
        }
        "undefined" != typeof exports ? exports.loadCSS = loadCSS: n.loadCSS = loadCSS
      } ("undefined" != typeof global ? global: this)
    </script>
     <link href="css/chunk-nationaldayhead-vendors.0f433423.css"
    rel="stylesheet" as="style" onload="this.onload=null,this.rel=&quot;stylesheet&quot;">
    <noscript>
      &lt;link href="https://qnlite.gtimg.com/qqnewslite/css/chunk-nationaldayhead-vendors.0f433423.css"
      rel="stylesheet"&gt;
    </noscript>
    <link rel="stylesheet" type="text/css" href="css/r-nationaldayhead.6e9074cf.css">
    <script charset="utf-8" src="js/r-nationaldayhead.516767eb.js">
    </script>
    <link rel="stylesheet" type="text/css" href="css/common.css">
  </head>
  <body class="">
    <div id="app">
      <!---->
      <div class="wrapper" style="background-image: url('img/background-image.png');">
        <!-- <img src="http://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83eruzEDjGnUFZ8czjIvuBY1xh7Fep9T2gPmRxBoczBVgctkgR2zmsibodaiaqqthY65KiaEYtWzMoxCEg/0"
        alt="" class="img-load" style="width: 9.5rem; position: fixed; top: 0px; left: -9999px;"> -->
        <div class="operation-header">
          <!-- <div class="h-logo">
          </div> -->
          <div class="h-title" style="background-image: url('img/title-image.png');">
          </div>
          <div class="h-slogan" style="background-image: url('img/slogan-image.png');">
          </div>
        </div>
        <div class="operation-number">
          目前已有&nbsp;
          <span>5222万</span>
          &nbsp;人次参与活动
    
        </div>
        <div class="operation-box">
          <div class="prev">
          </div>
          <div class="operation-img">
            <div class="cropper-content">

                <!--width: 1012px; height: 1012px; transform: scale(0.250324, 0.250324) translate3d(-1515.38px, -1515.38px, 0px) rotateZ(0deg)-->
              <div data-v-6dae58fd="" class="vue-cropper" id="vue-cropper">
                <div data-v-6dae58fd="" class="cropper-box" id="cropper-box">
                 <!--  <div data-v-6dae58fd="" class="cropper-box-canvas" style="">
                   
                 </div> -->
                  <img style="width: 100%;height: 100%;" src="img/head.png" alt="cropper-img" id="cropper-img">
                  <img src="img/hat1.png" class="frame-image" id="FrameImage">
                </div>
                <div data-v-6dae58fd="" class="cropper-drag-box cropper-move">
                </div>
                <div data-v-6dae58fd="" class="cropper-crop-box" style="width: 0px; height: 0px; transform: translate3d(0px, 0px, 0px); display: none;">
                  <span data-v-6dae58fd="" class="cropper-view-box">
                    <!-- <img data-v-6dae58fd="" src="blob:https://rl.inews.qq.com/ea5cb9d2-d588-467b-86c7-cc3b33cd260b"
                    alt="cropper-img" style="width: 1012px; height: 1012px; transform: scale(0.250324, 0.250324) translate3d(-1515.38px, -1515.38px, 0px) rotateZ(0deg);"> -->
                  </span>
                  <span data-v-6dae58fd="" class="cropper-face cropper-move">
                  </span>
                  <!---->
                  <!---->
                </div>
              </div>
            </div>
          </div>
          <div class="next">
          </div>
        </div>
          <div class="operation-btns">
          <div class="file-upload-container" id="fileUploadContainer">
            <input type="file" id="fle" accept="image/*" style="display: none;">
            <button type="button" id="up_button" class="button_qwe">
              <span class="button-icon">📁</span>
              <span class="button-text">上传图片</span>
            </button>
            <div class="upload-hint">支持拖放图片到此处</div>
          </div>
        </div>
        <div class="operation-btns">
          <!-- <div class="o-btn o-btn2" style="background-image:none;">
          
          
          </div> -->
          <button type="button" id="create" style="display: none;" class="button_qwe">
            <span class="button-icon">✨</span>
            <span class="button-text">生成头像</span>
          </button>  
        </div>
          <div class="operation-btns">
            <button type="button" id="down_button" style="display: none;" class="button_qwe">
              <span class="button-icon">💾</span>
              <span class="button-text">下载头像</span>
            </button>  
          </div>

        
        <!---->
        
        <div class="shade-box" style="display:none;z-index: 2004;width: 100%;height: 100%;position: fixed;top: 0;left: 0; background: rgba(0,0,0,0.3);"></div>
        <div class="van-popup van-popup--center" style="z-index: 2005;display: none;">
          <div class="long-press">
            <div class="l-img">
              <img id="head_img" src="data:image/png;bas5Ch/78WAENtJv2RKgAAAABJRU5ErkJggg==">
            </div>
            <div class="l-tips">
              长按保存图像
            </div>
          </div>
        </div>

       
      </div>
    </div>

    
    <script src="https://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>

   <script src="js/chunk-vendors.836075e1.js"></script>
     <script src="js/chunk-nationaldayhead-vendors.0ea1c589.js"></script>

    <!--<script src="https://qnlite.gtimg.com/qqnewslite/js/nationaldayhead.5241bf47.js"></script> -->
     <script src="js/WXJssdk.js"> </script>
     <script src="js/qqapi.js?_bid=152"> </script>
   
     <!-- <script type="text/javascript" src="https://mat1.gtimg.com/bbs/static/html2canvas.min.js" charset="utf-8"> </script> -->
    <script src="js/html2canvas.min.js"></script>


    <script type="text/javascript">
       var FrameImage = ['img/head0.png','img/head1.png','img/head2.png','img/head3.png','img/head4.png','img/head5.png','img/head6.png','img/head7.png','img/hat8.png','img/hat9.png','img/hat10.png','img/hat11.png','img/hat12.png','img/hat13.png','img/hat14.png','img/hat15.png','img/hat16.png','img/hat17.png','img/hat18.png','img/hat19.png','img/hat20.png','img/hat21.png','img/hat22.png','img/hat23.png'];
       var indexS = 0;
    
    function changeThemeType() {};

    // 右切换按钮点击事件
    $('.next').on('click', function() {
        // 添加点击动画效果
        $(this).addClass('pulse');
        setTimeout(() => {
            $(this).removeClass('pulse');
        }, 500);
        
        // 切换到下一个头像框
        indexS++;
        if (indexS >= FrameImage.length) {
            indexS = 0;
        }
        
        // 更新头像框图片
        $('#FrameImage').attr('src', FrameImage[indexS]);
        
        // 添加切换动画效果
        $('#FrameImage').fadeOut(100, function() {
            $(this).fadeIn(200);
        });
        
        console.log('当前头像框索引:', indexS);
    });
    
    // 左切换按钮点击事件
    $('.prev').on('click', function() {
        // 添加点击动画效果
        $(this).addClass('pulse');
        setTimeout(() => {
            $(this).removeClass('pulse');
        }, 500);
        
        // 切换到上一个头像框
        indexS--;
        if (indexS < 0) {
            indexS = FrameImage.length - 1;
        }
        
        // 更新头像框图片
        $('#FrameImage').attr('src', FrameImage[indexS]);
        
        // 添加切换动画效果
        $('#FrameImage').fadeOut(100, function() {
            $(this).fadeIn(200);
        });
        
        console.log('当前头像框索引:', indexS);
    });
    //上传
    $(document).on('click', '#up_button', function() {
      var fileInput = document.getElementById('fle');
      
      // 触发文件选择对话框
      if (fileInput) {
        fileInput.click();
      } else {
        console.error('文件输入元素未找到');
        showNotification('系统错误，请刷新页面重试', 'error');
      }
    });

    // 监听文件选择变化
    $(document).on('change', '#fle', function(e) {
      handleFileSelection(e.target.files[0]);
    });

    // 拖放上传功能
    var fileUploadContainer = document.getElementById('fileUploadContainer');
    
    // 阻止默认拖放行为
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
      fileUploadContainer.addEventListener(eventName, preventDefaults, false);
      document.body.addEventListener(eventName, preventDefaults, false);
    });
    
    function preventDefaults(e) {
      e.preventDefault();
      e.stopPropagation();
    }
    
    // 添加拖放高亮效果
    ['dragenter', 'dragover'].forEach(eventName => {
      fileUploadContainer.addEventListener(eventName, highlight, false);
    });
    
    ['dragleave', 'drop'].forEach(eventName => {
      fileUploadContainer.addEventListener(eventName, unhighlight, false);
    });
    
    function highlight() {
      fileUploadContainer.classList.add('drag-over');
    }
    
    function unhighlight() {
      fileUploadContainer.classList.remove('drag-over');
    }
    
    // 处理拖放的文件
    fileUploadContainer.addEventListener('drop', handleDrop, false);
    
    function handleDrop(e) {
      var dt = e.dataTransfer;
      var files = dt.files;
      
      if (files.length > 0) {
        handleFileSelection(files[0]);
      }
    }
    
    // 处理文件选择的通用函数
    function handleFileSelection(file) {
      // 检查是否选择了文件
      if (!file) {
        return;
      }
      
      // 检查文件类型
      if (!file.type.match('image.*')) {
        showNotification('请选择图片文件！', 'error');
        return;
      }
      
      // 检查文件大小（限制为4MB）
      var maxSize = 4 * 1024 * 1024; // 4MB
      if (file.size > maxSize) {
        showNotification('上传失败，请上传不大于4M的图片！', 'error');
        return;
      }
      
      // 读取并显示图片
      var reader = new FileReader();
      
      reader.onload = function(event) {
        try {
          // 显示图片
          $('#cropper-img').attr('src', event.target.result);
          
          // 显示生成头像按钮
          $('#create').css('display', 'inline-block');
          
          // 添加成功反馈
          $('#up_button .button-text').text('上传成功');
          setTimeout(() => {
            $('#up_button .button-text').text('上传图片');
          }, 2000);
          
          showNotification('图片上传成功！', 'success');
          
        } catch (error) {
          console.error('图片处理错误:', error);
          showNotification('图片处理失败，请重试！', 'error');
        }
      };
      
      reader.onerror = function() {
        console.error('文件读取错误');
        showNotification('文件读取失败，请重试！', 'error');
      };
      
      // 读取文件
      reader.readAsDataURL(file);
    }
    
    // 显示通知的函数
    function showNotification(message, type) {
      // 创建通知元素
      var notification = $('<div class="notification ' + type + '">' + message + '</div>');
      
      // 添加到页面
      $('body').append(notification);
      
      // 显示动画
      setTimeout(() => {
        notification.addClass('show');
      }, 10);
      
      // 自动隐藏
      setTimeout(() => {
        notification.removeClass('show');
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 3000);
    }


    //这是另一种写法
    $(function () {
        $(document).on('click', '#create', function () {
            // 添加加载状态
            var originalText = $("#create .button-text").text();
            $("#create .button-text").text("生成中...");
            $("#create").addClass("loading");
            $("#create").prop("disabled", true);
            
            try {
                var width = $('#cropper-box').width();
                var height = $('#cropper-box').height();
                var canvasBox = document.createElement("canvas"); 
                var scale = window.devicePixelRatio; 
                var rect = $('#cropper-box').get(0).getBoundingClientRect(); 
                canvasBox.width = width * scale; 
                canvasBox.height = height * scale; 

                canvasBox.style.width = width + "px";
                canvasBox.style.height = height + "px";
                canvasBox.getContext("2d").scale(scale, scale); 
                canvasBox.getContext("2d").translate(-rect.left, -rect.top); 

                setTimeout(function(){
                    html2canvas($("#cropper-box")[0], {
                        useCORS: true,
                        dpi: window.devicePixelRatio * 2,
                        allowTaint: true,
                        canvas: canvasBox,
                        scale: scale,
                        width: width,
                        height: height,
                        onrendered: function(canvas) {
                            try {
                                // 显示弹窗和遮罩
                                $('.van-popup--center').css('display', 'inline-block');
                                $('.shade-box').css('display', 'inline-block');
                                
                                // 设置生成的图片
                                $('#head_img').attr('src', canvas.toDataURL());
                                
                                // 设置下载链接
                                $('#down_button').attr('href', canvas.toDataURL());
                                $('#down_button').attr('download', '国庆头像.png');
                                
                                // 显示下载按钮
                                $('#down_button').css('display', 'inline-block');
                                
                                // 恢复按钮状态
                                $("#create .button-text").text(originalText);
                                $("#create").removeClass("loading");
                                $("#create").prop("disabled", false);
                                
                                // 显示成功通知
                                showNotification('头像生成成功！', 'success');
                            } catch (error) {
                                console.error('图片生成错误:', error);
                                showNotification('图片生成失败，请重试！', 'error');
                                $("#create .button-text").text(originalText);
                                $("#create").removeClass("loading");
                                $("#create").prop("disabled", false);
                            }
                        },
                        onerror: function(error) {
                            console.error('html2canvas错误:', error);
                            showNotification('图片生成失败，请重试！', 'error');
                            $("#create .button-text").text(originalText);
                            $("#create").removeClass("loading");
                            $("#create").prop("disabled", false);
                        }
                    }); 
                }, 10);
            } catch (error) {
                console.error('初始化错误:', error);
                showNotification('初始化失败，请重试！', 'error');
                $("#create .button-text").text(originalText);
                $("#create").removeClass("loading");
                $("#create").prop("disabled", false);
            }
        });

        // 点击遮罩关闭弹窗
        $(document).on('click', '.shade-box', function(){
            $('.shade-box').css('display', 'none');
            $('.van-popup--center').css('display', 'none');
        });
        
        // 下载按钮点击事件
        $(document).on('click', '#down_button', function(e) {
            e.preventDefault(); // 阻止默认行为
            
            // 添加下载反馈
            var originalText = $("#down_button .button-text").text();
            $("#down_button .button-text").text("下载中...");
            $("#down_button").addClass("loading");
            
            try {
                // 获取图片数据
                var imgData = $('#head_img').attr('src');
                if (!imgData || imgData.indexOf('data:image') !== 0) {
                    throw new Error('图片数据无效');
                }
                
                // 创建下载链接
                var downloadLink = document.createElement('a');
                downloadLink.href = imgData;
                downloadLink.download = '国庆头像.png';
                
                // 触发下载
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                // 恢复按钮状态并显示成功通知
                setTimeout(() => {
                    $("#down_button .button-text").text(originalText);
                    $("#down_button").removeClass("loading");
                    showNotification('头像下载成功！', 'success');
                }, 1000);
                
            } catch (error) {
                console.error('下载错误:', error);
                $("#down_button .button-text").text(originalText);
                $("#down_button").removeClass("loading");
                showNotification('下载失败，请重试！', 'error');
            }
        });
    });
    </script>
</br>
</body></html>